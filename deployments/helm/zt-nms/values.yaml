# Zero Trust NMS Helm Chart Values
# Default configuration values

# Global settings
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Namespace
namespaceOverride: ""

# Common labels
commonLabels: {}

# Common annotations
commonAnnotations: {}

# =============================================================================
# API Gateway
# =============================================================================
apiGateway:
  enabled: true
  replicaCount: 3
  
  image:
    repository: zt-nms/api-gateway
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 443
    metricsPort: 9090
  
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: nms.example.com
        paths:
          - path: /api
            pathType: Prefix
    tls:
      - secretName: zt-nms-tls
        hosts:
          - nms.example.com
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  podDisruptionBudget:
    enabled: true
    minAvailable: 2
  
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  config:
    serverPort: 8080
    tlsEnabled: true
    logLevel: info
    logFormat: json

# =============================================================================
# Identity Service
# =============================================================================
identityService:
  enabled: true
  replicaCount: 2
  
  image:
    repository: zt-nms/identity-service
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8081
    grpcPort: 50051
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  
  config:
    mfaRequired: true
    sessionTimeout: "8h"
    maxSessions: 5

# =============================================================================
# Policy Engine
# =============================================================================
policyEngine:
  enabled: true
  replicaCount: 2
  
  image:
    repository: zt-nms/policy-engine
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8082
    grpcPort: 50052
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  config:
    cacheTTL: "60s"
    defaultEffect: deny
    evaluationTimeout: "5s"

# =============================================================================
# Capability Issuer
# =============================================================================
capabilityIssuer:
  enabled: true
  replicaCount: 2
  
  image:
    repository: zt-nms/capability-issuer
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8083
    grpcPort: 50053
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  
  config:
    defaultTTL: "8h"
    maxTTL: "24h"
    maxDelegationDepth: 3

# =============================================================================
# Config Manager
# =============================================================================
configManager:
  enabled: true
  replicaCount: 2
  
  image:
    repository: zt-nms/config-manager
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8084
    grpcPort: 50054
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  config:
    requireApproval: true
    approvalQuorum: 2
    autoRollback: true
    verificationTimeout: "60s"

# =============================================================================
# Device Proxy
# =============================================================================
deviceProxy:
  enabled: true
  replicaCount: 3
  
  image:
    repository: zt-nms/device-proxy
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8085
    grpcPort: 50055
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  
  config:
    connectionTimeout: "30s"
    commandTimeout: "60s"
    maxOutputSize: 10485760
    sessionRecording: true

# =============================================================================
# Attestation Verifier
# =============================================================================
attestationVerifier:
  enabled: true
  replicaCount: 2
  
  image:
    repository: zt-nms/attestation-verifier
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8086
    grpcPort: 50056
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  
  config:
    requireTPM: false
    attestInterval: "1h"
    failureAction: alert

# =============================================================================
# Audit Service
# =============================================================================
auditService:
  enabled: true
  replicaCount: 2
  
  image:
    repository: zt-nms/audit-service
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8087
    grpcPort: 50057
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  
  config:
    retentionDays: 365
    archiveEnabled: true
    archiveDestination: "s3://zt-nms-audit/"

# =============================================================================
# Web UI
# =============================================================================
webUI:
  enabled: true
  replicaCount: 2
  
  image:
    repository: zt-nms/web-ui
    tag: "latest"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 80
  
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# =============================================================================
# PostgreSQL
# =============================================================================
postgresql:
  enabled: true
  
  auth:
    database: ztnms
    username: ztnms
    existingSecret: zt-nms-db-secret
    secretKeys:
      adminPasswordKey: postgres-password
      userPasswordKey: password
  
  primary:
    persistence:
      enabled: true
      size: 50Gi
    resources:
      requests:
        cpu: 250m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  
  readReplicas:
    replicaCount: 2
    persistence:
      enabled: true
      size: 50Gi
  
  metrics:
    enabled: true

# External PostgreSQL (if postgresql.enabled is false)
externalPostgresql:
  host: ""
  port: 5432
  database: ztnms
  username: ztnms
  existingSecret: ""
  existingSecretPasswordKey: password

# =============================================================================
# Redis
# =============================================================================
redis:
  enabled: true
  
  auth:
    enabled: true
    existingSecret: zt-nms-redis-secret
    existingSecretPasswordKey: password
  
  master:
    persistence:
      enabled: true
      size: 8Gi
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
  
  replica:
    replicaCount: 2
    persistence:
      enabled: true
      size: 8Gi
  
  sentinel:
    enabled: true
  
  metrics:
    enabled: true

# External Redis
externalRedis:
  host: ""
  port: 6379
  existingSecret: ""
  existingSecretPasswordKey: password

# =============================================================================
# NATS
# =============================================================================
nats:
  enabled: true
  
  cluster:
    enabled: true
    replicas: 3
  
  jetstream:
    enabled: true
    memStorage:
      enabled: true
      size: 1Gi
    fileStorage:
      enabled: true
      size: 10Gi
  
  natsBox:
    enabled: false

# External NATS
externalNats:
  url: ""

# =============================================================================
# etcd
# =============================================================================
etcd:
  enabled: true
  
  replicaCount: 3
  
  auth:
    rbac:
      enabled: true
      existingSecret: zt-nms-etcd-secret
  
  persistence:
    enabled: true
    size: 8Gi
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi

# External etcd
externalEtcd:
  endpoints: []
  username: ""
  existingSecret: ""
  existingSecretPasswordKey: password

# =============================================================================
# Monitoring
# =============================================================================
monitoring:
  # ServiceMonitor for Prometheus Operator
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
  
  # PrometheusRule for alerting
  prometheusRule:
    enabled: true
    rules:
      - alert: ZTNMSHighErrorRate
        expr: rate(ztnms_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High error rate in ZT-NMS
          description: Error rate is {{ $value }} errors/sec
      
      - alert: ZTNMSServiceDown
        expr: up{job=~"zt-nms.*"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: ZT-NMS service is down
          description: "{{ $labels.job }} is down"
      
      - alert: ZTNMSHighLatency
        expr: histogram_quantile(0.95, rate(ztnms_request_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High latency in ZT-NMS
          description: 95th percentile latency is {{ $value }}s
  
  # Grafana dashboards
  grafanaDashboards:
    enabled: true
    labels:
      grafana_dashboard: "1"

# =============================================================================
# Security
# =============================================================================
security:
  # Pod Security Policy
  podSecurityPolicy:
    enabled: false
  
  # Network Policy
  networkPolicy:
    enabled: true
    ingress:
      - from:
          - namespaceSelector:
              matchLabels:
                name: ingress-nginx
    egress:
      - to:
          - ipBlock:
              cidr: 0.0.0.0/0
        ports:
          - protocol: TCP
            port: 22
          - protocol: TCP
            port: 830
          - protocol: TCP
            port: 443
  
  # Pod Security Context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  
  # Container Security Context
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
        - ALL

# =============================================================================
# TLS
# =============================================================================
tls:
  # Use cert-manager to generate certificates
  certManager:
    enabled: true
    issuerRef:
      name: letsencrypt-prod
      kind: ClusterIssuer
  
  # Or provide existing secrets
  existingSecrets:
    server: ""
    ca: ""
    issuer: ""

# =============================================================================
# Secrets
# =============================================================================
secrets:
  # Create secrets from values (not recommended for production)
  create: false
  
  # Database password
  dbPassword: ""
  
  # Redis password
  redisPassword: ""
  
  # Issuer signing key (base64 encoded)
  issuerKey: ""
  
  # CA certificate and key (base64 encoded)
  caCert: ""
  caKey: ""

# =============================================================================
# Service Account
# =============================================================================
serviceAccount:
  create: true
  name: ""
  annotations: {}

# =============================================================================
# RBAC
# =============================================================================
rbac:
  create: true
